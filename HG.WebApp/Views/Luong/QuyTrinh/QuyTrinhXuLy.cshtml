@using HG.WebApp
@{
    ViewData["Title"] = "Quy trình xử lý";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    var NguoiDung = ViewBag.NguoiDung as List<HG.Entities.Entities.DanhMuc.DanhSachNguoiDung>;
    var PhongBan = ViewBag.PhongBan as List<HG.Entities.Dm_Phong_Ban>;
    var NhanhXuLy = ViewBag.NhanhXuLy as List<HG.Entities.Dm_Nhanh_Xu_Ly>;
}
<script src="https://cdn.rawgit.com/crlcu/multiselect/v2.5.1/dist/js/multiselect.min.js"></script>
@model HG.Entities.Entities.Luong.QuyTrinhXuLy_paging
<style>
    .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11 {
        float: left;
        position: relative;
        min-height: 1px;
        padding-right: 15px;
        padding-left: 15px;
    }
</style>
<div class="col-lg-12">
    <div class="pageheader">
        <div class="pageicon"><span class="iconfa-table"></span></div>
        <div class="pagetitle">
            <h5>Thông tin</h5>
            <h1>Quy trình xử lý</h1>
        </div>
    </div>
    <div class="maincontent">
        <div class="maincontentinner">
            <div>
                <span class="label label-success" style="font-size:14px;background-color: #5cb85c;">@Model.ten_luong</span>
            </div>
            <!-- Table with stripped rows -->
            <div class="tab-primary" style="border: 2px solid #0866c6;overflow: hidden;">
                <ul class="nav nav-pills" id="pills-tab" role="tablist" style="background: #0866c6;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(ViewBag.Views.Contains(StatusAction.View.ToString())?"active":"")" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#ds-buoc" role="tab" aria-controls="ds-buoc" aria-selected="true">Danh sách bước</button>
                    </li>
                    <li class="nav-item ui-state-default ui-corner-top" role="presentation">
                        <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#nhanh" role="tab" aria-controls="nhanh" aria-selected="false">Nhánh</button>
                    </li>
                    <li class="nav-item ui-state-default ui-corner-top" role="presentation">
                        <button class="nav-link @(ViewBag.Views.Contains(StatusAction.Add.ToString())?"active":"")" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#tt-buoc" role="tab" aria-controls="tt-buoc" aria-selected="false">Thông tin bước</button>
                    </li>
                </ul>

                <div class="tab-content" id="myTabContent" style="padding: 15px;">
                    @*Danh sách bước*@
                    <div class="tab-pane fade @(ViewBag.Views.Contains(StatusAction.View.ToString())?"show active":"")" id="ds-buoc" role="tabpanel" aria-labelledby="home-tab">
                        <div class="row" style="padding: 15px;">
                            <span id="ctl08_ctl00_grid_trinh_tu_xl_labNgayLuong" class="col-sm-6 Csslab">Quy trình: @Model.tong_ngay_qt ngày/TTHC: @Model.tong_ngay_tt ngày <span style="color:red">@(ViewBag.BuocXuLyChinh?"":"( Chưa có bước xử lý chính )")</span></span>
                            <div class="col-sm-6" align="right">
                                <button type="button" class="btn btn-primary" onclick="window.location.href='/Luong/QuyTrinhXuLy?code=@Model.ma_luong&views=@StatusAction.Add.ToString()'">Thêm bước</button>
                                <button type="button" class="btn btn-primary button" data-toggle="modal" data-target="#myModalLuongXuLy">Quy trình đồ họa</button>
                                <button type="button" class="btn btn-primary" onclick="window.location.href='/Luong/SuaLuongXuLy?code=@Model.ma_luong&type=View'">Đóng</button>

                            </div>
                        </div>
                        <div id="dataTable">
                            <div class="dataTable-container">
                                <table class="table table-bordered responsive">
                                    <thead class="widgettitle">
                                        <tr>
                                            <th class="head0" scope="col" data-sortable="" style="width: 5%;">STT</th>
                                            <th class="head1" scope="col" data-sortable="" style="width: 32%;">TÊN BƯỚC</th>
                                            <th class="head0" scope="col" data-sortable="" style="width: 8%;">NGƯỜI XỬ LÝ </th>
                                            <th class="head0" scope="col" data-sortable="" style="width: 5%;">THỨ TỰ </th>
                                            <th class="head1" scope="col" data-sortable="" style="width: 5%;">SỐ NGÀY</th>
                                            <th class="head0" scope="col" data-sortable="" style="width: 7%;">MÃ NHÁNH</th>
                                            <th class="head1" scope="col" data-sortable="" style="width: 3%;">#</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.lstQuyTrinhXuLy != null)
                                        {
                                            var stt = 1;
                                            foreach (var item in Model.lstQuyTrinhXuLy)
                                            {
                                                <tr>
                                                    <td scope="row">
                                                        @stt
                                                    </td>
                                                    <td><a href="/Luong/SuaQuyTrinhXuLy?code=@item.ma_luong&step=@item.Id">@item.ten_buoc</a></td>

                                                    <td>@item.nguoi_xl</td>
                                                    <td>@item.stt</td>
                                                    <td>@item.so_ngay_xl</td>
                                                    <td>@item.ma_nhanh</td>
                                                    <td>
                                                        <a id="" title="" data-placement="top" data-toggle="tooltip" data-original-title="Sửa" href="/Luong/SuaQuyTrinhXuLy?code=@item.ma_luong&step=@item.Id">
                                                            <span class="glyphicon glyphicon-edit">Sửa</span>
                                                        </a>
                                                    </td>
                                                </tr>
                                                stt++;
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    @*Nhánh *@
                    <div class="tab-pane fade" id="nhanh" role="tabpanel" aria-labelledby="profile-tab">
                        <div class="row" style="padding-bottom: 20px;">
                            <form id="form_nhanh">
                                <input hidden name="ma_luong" value="@Model.ma_luong" />
                                <input hidden name="type" value="@StatusAction.Add.ToString()" />
                                <div class="row">
                                    <label class="col-sm-1 control-label">
                                        Mã nhánh
                                    </label>
                                    <div class="col-sm-2">
                                        <input name="ma_nhanh" type="text" id="ma_nhanh" class="form-control input-default-sm" placeholder="Nhập mã nhánh">
                                    </div>
                                    <label class="col-sm-1 control-label">
                                        Tên nhánh
                                    </label>
                                    <div class="col-sm-5">
                                        <input name="ten_nhanh" type="text" id="ten_nhanh" class="form-control input-default-sm" placeholder="Nhập tên nhánh">
                                    </div>
                                    <div class="col-sm-2">
                                        <button type="button" onclick="ThemNhanh(this)" class="btn btn-primary">Thêm nhánh</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div id="Tab_Nhanh">
                            <div class="dataTable-container">
                                <table class="table table-bordered responsive">
                                    <thead class="widgettitle">
                                        <tr>
                                            <th class="head0" scope="col" data-sortable="" style="width: 5%;">STT</th>
                                            <th class="head1" scope="col" data-sortable="" style="width: 10%;">MÃ NHÁNH</th>
                                            <th class="head0" scope="col" data-sortable="" style="width: 75%;">TÊN NHÁNH </th>

                                            <th class="head0" scope="col" data-sortable="" style="width: 5%;">MÃ NHÁNH</th>
                                            <th class="head1" scope="col" data-sortable="" style="width: 5%;">#</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.lstNhanhXuLy != null && Model.lstNhanhXuLy.Count > 0)
                                        {
                                            var stt_nhanh = 1;
                                            foreach (var item in Model.lstNhanhXuLy)
                                            {
                                                <tr>
                                                    <td scope="row">
                                                        @stt_nhanh
                                                    </td>
                                                    <td><a href="#">@item.ma_nhanh</a></td>

                                                    <td>
                                                        @if (ViewBag.code == item.ma_nhanh)
                                                        {
                                                            <input id="ten_nhanh_@(item.ma_nhanh)" value="@item.ten_nhanh" class="form-control input-default-sm">
                                                        }
                                                        else
                                                        {
                                                            @item.ten_nhanh
                                                        }
                                                    </td>
                                                    <td>
                                                        @if (ViewBag.code == item.ma_nhanh)
                                                        {
                                                            <a href="#" onclick="LuuNhanh('@item.ma_luong','@item.ma_nhanh')">
                                                                <span class="glyphicon glyphicon-edit">Lưu</span>
                                                            </a>
                                                        }
                                                        else
                                                        {
                                                            <a href="#" onclick="SuaNhanh('@item.ma_luong','@item.ma_nhanh')">
                                                                <span class="glyphicon glyphicon-edit">Sửa</span>
                                                            </a>
                                                        }

                                                    </td>
                                                    <td>
                                                        <a href="#" onclick="XoaNhanh('@item.ma_luong','@item.ma_nhanh')">
                                                            <span class="glyphicon glyphicon-edit">Xóa</span>
                                                        </a>
                                                    </td>
                                                </tr>
                                                stt_nhanh++;
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    @*Thông tin bước *@
                    <div class="tab-pane fade @(ViewBag.Views.Contains(StatusAction.Add.ToString())?"show active":"")" id="tt-buoc" role="tabpanel" aria-labelledby="profile-tab">
                        <div class="form-horizontal">
                            <form id="form_pb" action="/Luong/ThemQuyTrinhXuLy" method="post" enctype="multipart/form-data">
                                <input type="hidden" name="ma_luong" value="@Model.ma_luong">
                                <div class="row" style="padding-bottom: 10px">
                                    <label class="col-md-2 control-label">
                                        Tên bước thực hiện
                                    </label>
                                    <input type="hidden" name="ma_buoc" id="ma_buoc" value="TN">
                                    <div class="col-md-3">
                                        <input name="ten_buoc" id="ten_buoc" type="text" value="" class="form-control input-default-sm" placeholder="Nhập tên bước thực hiện">
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-primary" onclick="myModalPopup()" data-bs-toggle="modal" data-bs-target="#ModalBXL">
                                            Chọn
                                        </button>
                                        <script>
                                            function myModalPopup() {
                                                $.ajax({
                                                    type: "GET",
                                                    url: "../Luong/RenderViewBuocThucHien?type=1",
                                                    data: "",
                                                    contentType: 'application/json; charset=utf-8',
                                                    success: function(data) {
                                                        console.log(data);
                                                        $("#ModalBXL .modal-body").html(data);
                                                    }
                                                });
                                            }
                                        </script>
                                    </div>
                                    <label class="col-md-2 control-label">
                                        Người mặc định XL
                                    </label>
                                    <div class="col-md-3">
                                        <select style="width: 100%;" class="select2 form-select form-control input-default" name="nguoi_xl_mac_dinh" id="nguoi_xl_mac_dinh">
                                            <option selected="selected" value="">---- Chọn người đại diện ----</option>
                                            @if (NguoiDung != null)
                                            {
                                                foreach (var item in NguoiDung)
                                                {

                                                    <option value="@item.UserName">@item.ten_nguoi_dung</option>

                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModalUser">
                                            Chọn
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <label class="col-md-2 control-label">
                                        Số ngày xử lý
                                    </label>
                                    <div class="col-md-3">
                                        <input name="so_ngay_xl" type="text" id="so_ngay_xl" class="form-control input-default-sm" placeholder="Nhập số ngày xử lý">
                                    </div>
                                    <div class="col-md-1"></div>
                                    <label class="col-md-2 control-label">Người có thể XL</label>
                                    <div class="col-md-3">

                                        <select id="multiselect" class="select2 form-select form-control input-default" multiple="" data-placeholder="Chọn người có thể xử lý" style="width: 100%;" tabindex="-1" aria-hidden="true">
                                            @if (NguoiDung != null)
                                            {
                                                foreach (var item in NguoiDung)
                                                {
                                                    <option value="@item.UserName">@item.ten_nguoi_dung</option>
                                                }
                                            }
                                        </select>
                                        <input id="nguoi_co_the_xl" type="text" name="nguoi_co_the_xl" class="form-control input-default" hidden>
                                        <input id="nguoi_co_the_xl2" type="text" name="nguoi_co_the_xl2" class="form-control input-default" hidden>


                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#basicModalXL">
                                            Chọn
                                        </button>
                                    </div>
                                </div>

                                <div class="row" style="padding-top: 10px; padding-bottom: 10px;">
                                    <label class="col-md-2 control-label"></label>
                                    <div class="col-md-3">
                                        <input type="checkbox" id="buoc_xl_chinh" name="buoc_xl_chinh">
                                        <label for="buoc_xl_chinh">Bước xử lý chính trong quy trình</label>
                                    </div>
                                    <div class="col-md-1"></div>
                                    <label class="col-md-2 control-label">Người phối hợp XL</label>
                                    <div class="col-md-3">
                                        <select id="multiselect2" class="select2 form-select form-control input-default" multiple="" data-placeholder="Chọn người phối hợp" style="width: 100%;" tabindex="-1" aria-hidden="true">
                                            @if (NguoiDung != null)
                                            {
                                                foreach (var item in NguoiDung)
                                                {
                                                    <option value="@item.UserName">@item.ten_nguoi_dung</option>
                                                }
                                            }
                                        </select>
                                        <input id="nguoi_phoi_hop_xl" type="text" name="nguoi_phoi_hop_xl" class="form-control input-default" hidden>
                                        <input id="nguoi_phoi_hop_xl2" type="text" name="nguoi_phoi_hop_xl2" class="form-control input-default" hidden>
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#basicModalPH">
                                            Chọn
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div id="ctl08_ctl00_ctl02">

                                        <label class="col-md-2 control-label">Nhánh</label>
                                        <div class="col-md-3">
                                            <select name="ma_nhanh" onchange="" id="ddlNhanh" class="form-control input-default-sm">
                                                <option selected="selected" value="">------ Gốc ------</option>
                                                @if (Model.lstNhanhXuLy != null && Model.lstNhanhXuLy.Count > 0)
                                                {
                                                    foreach (var item in Model.lstNhanhXuLy)
                                                    {
                                                        <option value="@item.ma_nhanh">@item.ten_nhanh</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <label class="col-md-2 control-label">Thứ tự bước</label>
                                        <div class="col-md-3">
                                            <select name="stt" id="FIndex" class="form-control input-default-sm">
                                                <option value="@(Model.Pagelist.TotalRecords + 1)">@(Model.Pagelist.TotalRecords + 1)</option>
                                                @if (Model.Pagelist.TotalRecords > 1)
                                                {
                                                    for (int i = Model.Pagelist.TotalRecords; i > 1; i--)
                                                    {
                                                        <option value="@i">@i</option>
                                                    }
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>


                                <div class="form-group">
                                    <label class="col-md-12">Các chức năng được sử dụng:</label>
                                </div>

                                <div id="ctl08_ctl00_pnlChucNang">
                                    <input type="hidden" name="chuc_nang" id="chuc_nang">

                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <span>
                                                <input type="checkbox" value="YCBSHS" class="ads_Checkbox_cn">
                                                <label for="YCBSHS">Yêu cầu bổ sung hồ sơ</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                            <span>
                                                <input id="HSKDK" type="checkbox" value="HSKDK" class="ads_Checkbox_cn">
                                                <label for="HSKDK">Hồ sơ không đủ điều kiện (Loại hồ sơ và trả cho công dân)</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <input id="THUHOIHS" type="checkbox" value="THUHOIHS" class="ads_Checkbox_cn">
                                            <label for="THUHOIHS">Thu hồi hồ sơ đã chuyển</label>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                            <span disabled="disabled">
                                                <input id="TRALAIHS" type="checkbox" value="TRALAIHS" class="ads_Checkbox_cn">
                                                <label for="TRALAIHS">Trả lại hồ sơ cho người chuyển</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <span>
                                                <input id="KYHS" type="checkbox" value="KYHS" class="ads_Checkbox_cn">
                                                <label for="KYHS">Ký duyệt hồ sơ</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                            <span>
                                                <input id="CMC" type="checkbox" value="CMC" class="ads_Checkbox_cn">
                                                <label for="CMC">Chuyển hồ sơ ra một cửa để trả KQ xử lý</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <input id="GUIHSLT" type="checkbox" value="GUIHSLT" class="ads_Checkbox_cn">
                                            <label for="GUIHSLT">Gửi liên thông hồ sơ</label>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                            <span>
                                                <input id="KTXL" type="checkbox" value="KTXL" class="ads_Checkbox_cn">
                                                <label for="KTXL">Hồ sơ không phải xử lý (Kết thúc xử lý)</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <span>
                                                <input id="INPHOIKQ" type="checkbox" value="INPHOIKQ" class="ads_Checkbox_cn">
                                                <label for="INPHOIKQ">In phôi kết quả xử lý</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                            <span>
                                                <input id="GUIKQLT" type="checkbox" value="GUIKQLT" class="ads_Checkbox_cn">
                                                <label for="GUIKQLT">Gửi hồi đáp kết quả xử lý cho đơn vị gửi liên thông</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <input id="THONGBAOCD" type="checkbox" value="THONGBAOCD" class="ads_Checkbox_cn">
                                            <label for="THONGBAOCD">Thông báo email cho công dân</label>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                            <span>
                                                <input id="TRATB" type="checkbox" value="TRATB" class="ads_Checkbox_cn">
                                                <label for="TRATB">Trả thông báo</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                    <div class="row">
                                        <label class="col-md-2 control-label"></label>
                                        <div class="col-md-3">
                                            <span>
                                                <input id="GIAHAN" type="checkbox" value="GIAHAN" class="ads_Checkbox_cn">
                                                <label for="GIAHAN">Gia hạn xử lý</label>
                                            </span>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-5">
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>


                                </div>

                                <div class="row" style="padding-top: 15px;">
                                    <div class="col-md-3"></div>
                                    <div class="col-md-4">
                                        <input type="submit" name="" value="Lưu" id="btnSave" class="btn btn-primary process">
                                        <input type="button" name="" value="Đóng" id="btnClose" class="btn btn-primary" onclick="window.location.href='/Luong/QuyTrinhXuLy?code=@Model.ma_luong&views=@StatusAction.View.ToString()'">
                                    </div>
                                    <div class="col-md-5">
                                        <br>
                                        <span id="TongSoNgayTT" style="color:Blue;">Tổng số ngày của thủ tục: @Model.tong_ngay_tt Ngày</span>
                                        <br>
                                        <span id="TongSoNgayXL" style="color:Blue;">Tổng số ngày của quy trình:  @Model.tong_ngay_qt Ngày</span>
                                        <br>
                                        <span style="color:red;">@((Model.tong_ngay_qt> Model.tong_ngay_tt) ?"Tổng số ngày của quy trình lớn hơn tổng số ngày của thủ tục":"")</span>
                                        <br>
                                    </div>
                                </div>
                            </form><!-- End Horizontal Form -->
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

</div>

<div class="modal fade" id="ModalBXL" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header widgettitle">
                <h5 class="modal-title">Danh sách bước xử lý</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div><!-- End Basic Modal-->


<div class="modal fade" id="myModalUser">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header widgettitle">
                <h5 class="modal-title">Danh sách</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="padding-bottom: 0;">
                <div class="widget">
                    <h4 class="widgettitle">Chọn cán bộ</h4>
                    <div class="widgetcontent">
                        <div class="form-group">
                            <select onchange="getUserByPb(this);" name="" id="ddlPhongBan1" class="form-control input-default">
                                <option value="0">------------ Toàn bộ phòng ban ------------</option>
                                @if (PhongBan != null)
                                {
                                    foreach (var item in PhongBan)
                                    {
                                        <option value="@item.ma_phong_ban">@item.ten_phong_ban</option>
                                    }
                                }

                            </select>
                        </div>
                        <div class="form-group">
                            <span id="singleselect" class="">

                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="modal fade" id="basicModalPH" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header widgettitle">
                <h5 class="modal-title">Danh sách</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="widget">
                    <h4 class="widgettitle">Chọn cán bộ</h4>
                    <div class="widgetcontent">
                        <div class="form-group">
                            <select name="ddlPhongBan" id="ddlPhongBan" class="form-control input-default" onchange="ChonPhongBan(this)">
                                @if (PhongBan != null && PhongBan.Count > 0)
                                {
                                    <option value="">Chọn phòng ban</option>
                                    foreach (var item in PhongBan)
                                    {
                                        <option onclick="ChonChonChoHaKhong()" value="@item.ma_phong_ban">@item.ten_phong_ban</option>
                                    }
                                }

                            </select>
                        </div>
                        <div class="form-group" id="Nguoidungtimkiem">
                            <select id='pre-selected-options' multiple='multiple'>
                                @if (NguoiDung != null)
                                {
                                    foreach (var item in NguoiDung)
                                    {

                                        <option value="@item.UserName">@item.ten_nguoi_dung</option>

                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="ChonNguoiDung()" data-bs-dismiss="modal">Chọn</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div><!-- End Basic Modal-->

<div class="modal fade" id="basicModalXL" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header widgettitle">
                <h5 class="modal-title">Danh sách</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="widget">
                    <h4 class="widgettitle">Chọn cán bộ</h4>
                    <div class="widgetcontent">
                        <div class="form-group">
                            <select name="ddlPhongBan" id="ddlPhongBan" class="form-control input-default" onchange="ChonPhongBanXL(this)">
                                @if (PhongBan != null && PhongBan.Count > 0)
                                {
                                    <option value="">Chọn phòng ban</option>
                                    foreach (var item in PhongBan)
                                    {
                                        <option onclick="Chon_XL()" value="@item.ma_phong_ban">@item.ten_phong_ban</option>
                                    }
                                }

                            </select>
                        </div>
                        <div class="form-group" id="Nguoidungtimkiem_XL">
                            <select id='Nguoi_XL' multiple='multiple'>
                                @if (NguoiDung != null)
                                {
                                    foreach (var item in NguoiDung)
                                    {

                                        <option value="@item.UserName">@item.ten_nguoi_dung</option>

                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="ChonNguoiDung_XL()" data-bs-dismiss="modal">Chọn</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div><!-- End Basic Modal-->
<link rel="stylesheet" type="text/css" href="../BackEnd/Admin/DualSelect/multi-select.css">
<script src="../BackEnd/Admin/DualSelect/jquery.multi-select.js"></script>



<script>


    function ChonPhongBan(data) {
        $.ajax({
            type: "GET",
            url: "../Luong/NguoiDungPhongBan?code=" + data.value + "&type=PH",
            data: "",
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                $("#Nguoidungtimkiem").html(data);
                $('#pre-selected-options').multiSelect('select', $("#nguoi_phoi_hop_xl").val().split(";"));
            }
        });
    }


    function ChonPhongBanXL(data) {
        $.ajax({
            type: "GET",
            url: "../Luong/NguoiDungPhongBan?code=" + data.value + "&type=XL",
            data: "",
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                $("#Nguoidungtimkiem_XL").html(data);
                $('#Nguoi_XL').multiSelect('select', $("#nguoi_co_the_xl").val().split(";"));
            }
        });
    }


    function changePageSize(data) {
        $("#lstPageSize").val(data.value);
        $.ajax({
            type: "GET",
            url: "../Luong/LuongXuLyPaging?currentPage=" + 1 + "&pageSize=" + data.value + "&tu_khoa=",
            data: "",
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                //console.log(data);
                $("#dataTable").html(data);
            }
        });
    }

    function DeleteMultiple() {
        var listData = $("#lstCode").val();
        confirm.BeforDeletePost('/Luong/XoaLuongXuLy?code=' + listData)
    }

    $(function() {
        $('#selectAll').click(function() {
            var val = [];
            if ($(this).is(':checked')) {
                $(".ads_Checkbox").prop("checked", true);
                $(':checkbox:checked').each(function(i) {
                    if (i > 0) {
                        val[i - 1] = $(this).val();
                    }
                });
            }
            else {
                $(".ads_Checkbox").prop("checked", false);
                val = [];
            }
            $("#lstCode").val(val);
        });


        $('.ads_Checkbox_cn').click(function() {
            var val = [];
            $(':checkbox:checked').each(function(i) {
                val[i] = $(this).val();
            });
            $("#chuc_nang").val(val);
        });

    });
    var Arr = [];
    var Arr2 = [];


    $(document).ready(function() {
       $('#form_pb').submit(function() {
            if (($("#ten_buoc").val() == '')) {
                alert('Chưa chọn tên bước.');
                document.getElementById("ten_buoc").focus();
                return false;
            }
            if (($("#so_ngay_xl").val() == '')) {
                alert('Chưa chọn số ngày xử lý.');
                document.getElementById("so_ngay_xl").focus();
                return false;
            }
            if (($("#nguoi_xl_mac_dinh").val() == '')) {
                alert('Chưa chọn người xử lý.');
                document.getElementById("nguoi_xl_mac_dinh").focus();
                return false;
            }
        });

        $('#so_ngay_xl').keypress(function(event) {
            if (event.which != 46 && (event.which < 47 || event.which > 59)) {
                event.preventDefault();
                if ((event.which == 46) && ($(this).indexOf('.') != -1)) {
                    event.preventDefault();
                }
            }
        });

        jQuery.validator.addMethod("ma_vaild", function(value, element) {
            if (/[ `!#$%^&*()+\=\[\]{};':"\\|,<>\/?~]/.test(value)) {
                return false;
            } else {
                return true;
            };
        }, "Mã không nhập các kí tự đặc biệt [ `!#$%^&*()+\=\[\]{};':\\|,<>\/?~]");

        $('#form_nhanh').validate({
            rules: {
                ma_nhanh: {
                    required: true,
                    ma_vaild: true
                },
                ten_nhanh: "required",
            },
            messages: {
                ma_nhanh: {
                    required: "Bạn cần nhập mã nhánh!",
                },
                ten_nhanh: "Bạn cần nhập tên nhánh !",
            }
        });

        $('.select2').select2({
            closeOnSelect: false
        });

        $("#buoc_xl_chinh").val($("#buoc_xl_chinh").is(':checked'));

        $('#buoc_xl_chinh').change(function() {
            $('#buoc_xl_chinh').val($(this).is(':checked'));
        });

        $('#multiselect').on('select2:select', function(e) {
            Arr.push(e.params.data.id);
            $("#nguoi_co_the_xl").val(Arr.join(";"));
        });

        $('#multiselect').on("select2:unselect", function(e) {
            Arr.pop(e.params.data.id);
            $("#nguoi_co_the_xl").val(Arr.join(";"));
        });

        $('#multiselect2').on('select2:select', function(e) {
            Arr2.push(e.params.data.id);
            $("#nguoi_phoi_hop_xl").val(Arr2.join(";"));
        });

        $('#multiselect2').on("select2:unselect", function(e) {
            Arr2.pop(e.params.data.id);
            $("#nguoi_phoi_hop_xl").val(Arr2.join(";"));
        });

        $('#myModalUser').on('shown.bs.modal', function() {
            var data = { ma_phong_ban: "" };
            $.ajax({
                url: '@Url.Action("RenderViewNguoiDung", "DanhMuc")',
                type: "post",
                contentType: 'application/x-www-form-urlencoded',
                data: data,
                success: function(result) {
                    $("#singleselect").html(result);
                }
            });
        })

    });
    var ArrUser = [];
    $('#basicModalPH').on('shown.bs.modal', function() {
        $('#pre-selected-options').multiSelect('deselect_all');
        $('#pre-selected-options').multiSelect('select', $("#nguoi_phoi_hop_xl").val().split(";"));
    })

    function ChonNguoiDung() {
        var lstGroup = $("#nguoi_phoi_hop_xl2").val();
        lstGroup.split(";").forEach(function(item) {
            Arr2.push(item);
        });
        $("#nguoi_phoi_hop_xl").val(Arr2.join(";"));
        $("#multiselect2").val($("#nguoi_phoi_hop_xl2").val().split(";")).trigger('change');
    }

    $('#pre-selected-options').multiSelect({
        afterSelect: function(values) {
            String(values).split(",").forEach(function(item) {
                ArrUser.push(item);
            });
            $("#nguoi_phoi_hop_xl2").val(ArrUser.join(";"));
        },
        afterDeselect: function(values) {
            String(values).split(",").forEach(function(item) {
                ArrUser.pop(item);
            });
            $("#nguoi_phoi_hop_xl2").val(ArrUser.join(";"));
        }
    });
    $('#pre-selected-options').multiSelect();

    var ArrUserXL = [];
    $('#basicModalXL').on('shown.bs.modal', function() {
        $('#Nguoi_XL').multiSelect('deselect_all');
        $('#Nguoi_XL').multiSelect('select', $("#nguoi_co_the_xl").val().split(";"));
    })

    function ChonNguoiDung_XL() {
        var lstGroup = $("#nguoi_co_the_xl2").val();
        lstGroup.split(";").forEach(function(item) {
            Arr.push(item);
        });
        $("#nguoi_co_the_xl").val(Arr.join(";"));
        $("#multiselect").val($("#nguoi_co_the_xl2").val().split(";")).trigger('change');
    }

    $('#Nguoi_XL').multiSelect({
        afterSelect: function(values) {
            String(values).split(",").forEach(function(item) {
                ArrUserXL.push(item);
            });
            $("#nguoi_co_the_xl2").val(ArrUserXL.join(";"));
        },
        afterDeselect: function(values) {
            String(values).split(",").forEach(function(item) {
                ArrUserXL.pop(item);
            });
            $("#nguoi_co_the_xl2").val(ArrUserXL.join(";"));
        }
    });
    $('#Nguoi_XL').multiSelect();

    function SuaNhanh(ma_luong, ma_nhanh) {
        var dataPost = "ma_luong=" + ma_luong + "&ma_nhanh=" + ma_nhanh;
        $.ajax({
            url: "/Luong/SuaNhanh",
            type: "post",
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: dataPost,
            success: function(result) {
                $("#Tab_Nhanh").html(result);
            }
        });
    }

    function getUserByPb(data) {
        var data = { ma_phong_ban: data.value };
        $.ajax({
            url: '@Url.Action("RenderViewNguoiDung", "DanhMuc")',
            type: "post",
            contentType: 'application/x-www-form-urlencoded',
            data: data,
            success: function(result) {
                $("#singleselect").html(result);
            }
        });
    }
    function getUser(data) {
        $('#nguoi_xl_mac_dinh').val($(':selected', data).attr("data-id"));
        $('#nguoi_xl_mac_dinh').select2().trigger('change');
        $("#myModalUser").modal("hide");
    }

    function LuuNhanh(ma_luong, ma_nhanh) {
        var ten_nhanh = $("#ten_nhanh_" + ma_nhanh).val();
        var dataPost = "ma_luong=" + ma_luong + "&ma_nhanh=" + ma_nhanh + "&ten_nhanh=" + ten_nhanh;

        $.ajax({
            url: "/Luong/LuuNhanh",
            type: "post",
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: dataPost,
            success: function(result) {
                $("#Tab_Nhanh").html(result);
            }
        });
    }

    function ThemNhanh() {
        if ($("#form_nhanh").valid()) {
            var dataPost = $("#form_nhanh").serialize();
            $.ajax({
                url: "/Luong/LuuNhanh",
                type: "post",
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                data: dataPost,
                success: function(result) {
                    console.log(result);
                    $("#Tab_Nhanh").html(result);
                }
            });
        }
    }

    function XoaNhanh(ma_luong, ma_nhanh) {
        bootbox.confirm({
            message: "Bạn có muốn xóa không?",
            buttons: {
                confirm: {
                    label: 'Có',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'Không',
                    className: 'btn-danger'
                }
            },
            callback: function(result) {
                if (result) {
                    var dataPost = "ma_luong=" + ma_luong + "&ma_nhanh=" + ma_nhanh;
                    $.ajax({
                        url: "/Luong/XoaNhanh",
                        type: "post",
                        contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                        data: dataPost,
                        success: function(result) {
                            console.log(result);
                            $("#Tab_Nhanh").html(result);
                        }
                    });
                }
            }
        });
    }
</script>


